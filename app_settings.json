{
  "forms": {},
  "schedules": [],
  "contact_summary": "var ContactSummary = {}; !function(e,t){if('object'==typeof exports&&'object'==typeof module)module.exports=t();else if('function'==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)('object'==typeof exports?exports:e)[o]=r[o]}}(ContactSummary,(function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&'object'==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,'default',{enumerable:!0,value:e}),2&t&&'string'!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,'a',t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p='',r(r.s=0)}([function(e,t,r){var o=r(1),n=r(3);e.exports=n(o,contact,reports)},function(e,t,r){let o=r(2);const n=reports,i=[{label:'contact.profile.performance.monthly_meeting',appliesToType:'report',appliesIf:e=>{if('chw_monthly_meeting'===e.form){const t=o.getNewestReport(n,'chw_monthly_meeting');if(t)return t.reported_date===e.reported_date}return!1},fields:[{label:'contact.profile.performance.monthly_meeting.goal',value:e=>{const t=new Date(e.reported_date);if(t.getMonth()===o.CURRENT_MONTH&&t.getFullYear()===o.CURRENT_YEAR){const e=o.getReportsThisMonth(n,'chw_monthly_meeting').length;return`${100*e}% (${e} out of 1)`}return'0% (0 out of 1)'},width:6},{label:'contact.profile.performance.monthly_meeting.last_date',value:e=>e.reported_date,filter:'simpleDate',width:6}]},{label:'contact.profile.performance.group_session',appliesToType:'report',appliesIf:e=>{if('group_session'===e.form){const t=o.getNewestReport(n,'group_session');if(t)return t.reported_date===e.reported_date}return!1},fields:[{label:'contact.profile.performance.group_session.goal',value:e=>{const t=new Date(e.reported_date);if(t.getMonth()===o.CURRENT_MONTH&&t.getFullYear()===o.CURRENT_YEAR){const e=o.getReportsThisMonth(n,'group_session').length;return`${100*e}% (${e} out of 1)`}return'0% (0 out of 1)'},width:6},{label:'contact.profile.performance.group_session.last_date',value:e=>e.reported_date,filter:'simpleDate',width:6}]},{label:'contact.profile.performance.quality_monitoring',appliesToType:'report',appliesIf:e=>{if('quality_monitoring'===e.form){const t=o.getNewestReport(n,'quality_monitoring');if(t)return t.reported_date===e.reported_date}return!1},fields:[{label:'contact.profile.performance.quality_monitoring.goal',value:e=>{const t=new Date(e.reported_date);if(t.getMonth()===o.CURRENT_MONTH&&t.getFullYear()===o.CURRENT_YEAR){const e=o.getReportsThisMonth(n,'quality_monitoring').length;return`${100*e}% (${e} out of 1)`}return'0% (0 out of 1)'},width:6},{label:'contact.profile.performance.quality_monitoring.last_date',value:e=>e.reported_date,filter:'simpleDate',width:6}]}];e.exports={cards:i}},function(e,t){const r=new Date,o=r.getMonth(),n=r.getFullYear();e.exports={CURRENT_MONTH:o,CURRENT_YEAR:n,getNewestReport:function(e,t){let r,o;for(let n=1;n<e.length;n++)o=e[n],console.log('Form is '+o.form),r||o.form!==t?o.form===t&&r.reported_date<o.reported_date&&(r=o):r=o;return r},getReportsThisMonth:function(e,t){let r,i=[];for(const l of e)r=new Date(l.reported_date),l.form===t&&r.getMonth()===o&&r.getFullYear()===n&&i.push(l);return i}}},function(e,t){function r(e){return e?Array.isArray(e)?e:[e]:[]}function o(e,t){switch(typeof e){case'undefined':return!0;case'function':return e(t);default:return e}}function n(e,t,r){if(o(e.appliesIf,r)){var n='function'==typeof e.fields?e.fields(r):e.fields.filter((function(e){return o(e.appliesIf,r)})).map((function(e){var t={};return i(e,t,'label'),i(e,t,'value'),i(e,t,'translate'),i(e,t,'filter'),i(e,t,'width'),i(e,t,'icon'),e.context&&(t.context={},i(e.context,t.context,'count'),i(e.context,t.context,'total')),t}));return e.modifyContext&&e.modifyContext(t,r),{label:e.label,fields:n}}function i(e,t,o){switch(typeof e[o]){case'undefined':return;case'function':t[o]=e[o](r);break;default:t[o]=e[o]}}}e.exports=function(e,t,o){var i=e.fields||[],l=e.context||{},a=e.cards||[],f=t&&('contact'===t.type?t.contact_type:t.type),p={cards:[],fields:i.filter((function(e){var t=r(e.appliesToType),o=t.filter((function(e){return e&&'!'===e.charAt(0)}));if((0===t.length||t.includes(f)||o.length>0&&!o.includes('!'+f))&&(!e.appliesIf||e.appliesIf()))return delete e.appliesToType,delete e.appliesIf,!0}))};return a.forEach((function(e){var t,i,a,u,c=r(e.appliesToType);if(c.includes('report')&&c.length>1)throw new Error('You cannot set appliesToType to an array which includes the type \\'report\\' and another type.');if(c.includes('report'))for(t=0;t<o.length;++t)i=o[t],!(u=i)||u.errors&&u.errors.length||(a=n(e,l,i))&&p.cards.push(a);else{if(!c.includes(f)&&c.length>0)return;(a=n(e,l))&&p.cards.push(a)}})),p.context=l,p}}])})); return ContactSummary;",
  "tasks": {
    "rules": "define Target { _id: null, contact: null, deleted: null, type: null, pass: null, date: null, groupBy: null }\ndefine Contact { contact: null, reports: null, tasks: null }\ndefine Task { _id: null, deleted: null, doc: null, contact: null, icon: null, date: null, readyStart: null, readyEnd: null, title: null, fields: null, resolved: null, priority: null, priorityLabel: null, reports: null, actions: null }\nrule GenerateEvents {\n  when { c: Contact } then { !function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&'object'==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,'default',{enumerable:!0,value:e}),2&t&&'string'!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,'a',t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p='',n(n.s=1)}([function(e,t){e.exports=function(e){var t={};!function e(t,n){var i=Object.keys(t);for(var o in i){var a=i[o];switch(typeof t[a]){case'object':e(t[a],n);break;case'function':t[a]=t[a].bind(n)}}}(e,t),t.definition=function e(t){var n=Object.assign({},t),i=Object.keys(n);for(var o in i){var a=i[o];if(Array.isArray(n[a])){n[a]=n[a].slice(0);for(var r=0;r<n[a].length;++r)'object'==typeof n[a][r]&&(n[a][r]=e(n[a][r]))}else'object'==typeof n[a]&&(n[a]=e(n[a]))}return n}(e)}},function(e,t,n){var i=n(2),o=n(3),a=n(4);n(6)(o,c,Utils,Target,emit),a(i,c,Utils,Task,emit),emit('_complete',{_id:!0})},function(e,t){e.exports=[{name:'quality-monitoring-task',icon:'general',title:'task.quality_monitoring',appliesTo:'reports',appliesIf:function(){return user.parent&&'district_hospital'===user.parent.type},appliesToType:['quality_monitoring_planning'],actions:[{type:'report',form:'quality_monitoring'}],events:[{id:'quality-monitoring-1',dueDate:function(e,t,n){let i='';return i=n.fields&&n.fields.visit_details&&n.fields.visit_details.planned_visit_date?new Date(n.fields.visit_details.planned_visit_date):new Date,i},start:2,end:2}]},{name:'shadowing-reminder-task',icon:'general',title:'task.shadowing_reminder',appliesTo:'reports',appliesIf:function(){return user.parent&&'health_center'===user.parent.type},appliesToType:['quality_monitoring_planning'],actions:[{type:'report',form:'shadowing_reminder',modifyContent:function(e,t,n){n.fields&&n.fields.visit_details&&n.fields.visit_details.planned_visit_date?e.t_planned_visit_date=n.fields.visit_details.planned_visit_date:e.t_planned_visit_date='the planned visit date.'}}],resolvedIf:function(e,t,n,i){return Utils.isFormSubmittedInWindow(e.reports,'quality_monitoring',Utils.addDate(i,-n.start).getTime(),Utils.addDate(i,n.end+1).getTime())},events:[{id:'shadowing-reminder-1',dueDate:function(e){let t='';return t=e.fields&&e.fields.visit_details&&e.fields.visit_details.planned_visit_date?new Date(e.fields.visit_details.planned_visit_date):new Date,t},start:2,end:2}]},{name:'chw-monthly-meeting-task-1',icon:'confirm-meeting',title:'task.chw_monthly_meeting',appliesTo:'reports',appliesToType:['chw_monthly_meeting'],appliesIf:function(){return user.parent&&'district_hospital'===user.parent.type},actions:[{type:'report',form:'chw_monthly_meeting'}],resolvedIf:function(e){let t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,0);return Utils.isFormSubmittedInWindow(e.reports,'chw_monthly_meeting',n,i)},events:[{id:'chw-monthly-meeting-1',dueDate:function(e){let t='';return t=e.fields&&e.fields.next_meeting_details&&e.fields.next_meeting_details.next_meeting_date?new Date(e.fields.next_meeting_details.next_meeting_date):new Date,t},start:3,end:3}]},{name:'chw-monthly-meeting-task-2',icon:'confirm-meeting',title:'task.chw_monthly_meeting',appliesTo:'contacts',appliesToType:['district_hospital'],appliesIf:function(){return user.parent&&'district_hospital'===user.parent.type},actions:[{type:'report',form:'chw_monthly_meeting'}],resolvedIf:function(e){let t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,0);return Utils.isFormSubmittedInWindow(e.reports,'chw_monthly_meeting',n,i)},events:[{id:'chw-monthly-meeting-1',dueDate:function(){let e=new Date;return new Date(e.getFullYear(),e.getMonth(),3)},start:3,end:3}]},{name:'quality-monitoring-follow-up-task-1',icon:'general',title:'task.quality_monitoring_follow_up',appliesTo:'reports',appliesIf:function(e,t){return t.fields&&'yes'===t.fields.c_needs_follow_up&&user.parent&&'district_hospital'===user.parent.type},appliesToType:['quality_monitoring'],actions:[{type:'report',form:'quality_monitoring_follow_up'}],events:[{id:'quality-monitoring-follow-up-1',days:21,start:2,end:2}]},{name:'quality-monitoring-follow-up-task-2',icon:'general',title:'task.quality_monitoring_follow_up',appliesTo:'reports',appliesIf:function(e,t){return t.fields&&t.fields.follow_up_details&&'yes'===t.fields.follow_up_details.follow_up_again&&user.parent&&'district_hospital'===user.parent.type},appliesToType:['quality_monitoring_follow_up'],actions:[{type:'report',form:'quality_monitoring_follow_up'}],events:[{id:'quality-monitoring-follow-up-1',dueDate:function(e,t,n){return n.fields&&n.fields.follow_up_details&&n.fields.follow_up_details.next_follow_up_date?new Date(n.fields.follow_up_details.next_follow_up_date):new Date},start:2,end:2}]}]},function(e,t){e.exports=[]},function(e,t,n){var i=n(0),o=n(5);function a(e,t,n,i,o,a){var r;if(e.appliesToType){var s;if('contacts'===e.appliesTo){if(!o.contact)return;s='contact'===o.contact.type?o.contact.contact_type:o.contact.type}else{if(!a)return;s=a.form}if(-1===e.appliesToType.indexOf(s))return}if('scheduled_tasks'===e.appliesTo||!e.appliesIf||e.appliesIf(o,a))if('scheduled_tasks'===e.appliesTo){if(a&&e.appliesIf){if(!a.scheduled_tasks)return;for(r=0;r<a.scheduled_tasks.length;r++)e.appliesIf(o,a,r)&&d(r)}}else d();function l(e,t,n){var i;return(i='function'==typeof e.contactLabel?e.contactLabel(t,n):e.contactLabel)?{name:i}:t.contact}function d(r){var s,d,c,f,u=null;for(s=0;s<e.events.length;s++){if((d=e.events[s]).dueDate)u=d.dueDate(d,o,a,r);else if(a)u=void 0!==r?new Date(t.addDate(new Date(a.scheduled_tasks[r].due),d.days)):new Date(t.addDate(new Date(a.reported_date),d.days));else if(d.dueDate)u=d.dueDate(d,o);else{var _=o.contact&&o.contact.reported_date?new Date(o.contact.reported_date):new Date;u=new Date(t.addDate(_,d.days))}t.isTimely(u,d)&&(f={_id:(a?a._id:o.contact&&o.contact._id)+'~'+(d.id||s)+'~'+e.name,deleted:!(!(o.contact&&o.contact.deleted||a)||!a.deleted),doc:o,contact:l(e,o,a),icon:e.icon,date:u,readyStart:d.start||0,readyEnd:d.end||0,title:e.title,resolved:e.resolvedIf(o,a,d,u,r),actions:p(e.actions,d)},void 0!==r&&(f._id+='-'+r),'function'==typeof(c=e.priority)&&(c=c(o,a)),c&&(f.priority=c.level,f.priorityLabel=c.label),i('task',new n(f)))}}function p(t,n){return e.actions.map((function(e){return function(e,t){var n={source:'task',source_id:a?a._id:o.contact&&o.contact._id,contact:o.contact};e.modifyContent&&e.modifyContent(n,o,a,t);return{type:e.type||'report',form:e.form,label:e.label||'Follow up',content:n}}(e,n)}))}}e.exports=function(e,t,n,r,s){if(e)for(var l,d,p=0;p<e.length;++p)switch('function'!=typeof(l=Object.assign({},e[p],o)).resolvedIf&&(l.resolvedIf=function(e,t,i,o){return l.defaultResolvedIf(e,t,i,o,n)}),i(l),l.appliesTo){case'reports':case'scheduled_tasks':for(var c=0;c<t.reports.length;++c)d=t.reports[c],a(l,n,r,s,t,d);break;case'contacts':t.contact&&a(l,n,r,s,t);break;default:throw new Error('Unrecognised task.appliesTo: '+l.appliesTo)}}},function(e,t){e.exports={defaultResolvedIf:function(e,t,n,i,o){var a,r;o||(o=Utils);var s=function(e){var t;if(!e||!e.actions)return;return(t=e.actions.find((function(e){return!e.type||'report'===e.type})))&&t.form}(this.definition);if(!s)throw new Error('Could not find the default resolving form!');return a=0,a=t?Math.max(o.addDate(i,-n.start).getTime(),t.reported_date+1):o.addDate(i,-n.start).getTime(),r=o.addDate(i,n.end+1).getTime(),o.isFormSubmittedInWindow(e.reports,s,a,r)}}},function(e,t,n){var i=n(0);function o(e,t,n,i,o,a){var r=!!a;if(o.contact){var s='contact'===o.contact.type?o.contact.contact_type:o.contact.type,l=r?a.form:s;if(!(e.appliesToType&&e.appliesToType.indexOf(l)<0)&&(!e.appliesIf||e.appliesIf(o,a)))for(var d=r?a:o.contact,p=function(e,t,n){var i;return i='function'==typeof e.idType?e.idType(t,n):'report'===e.idType?n&&n._id:t.contact&&t.contact._id,Array.isArray(i)||(i=[i]),i}(e,o,a),c=!e.passesIf||!!e.passesIf(o,a),f=function(e,t,n,i){if('function'==typeof e.date)return e.date(n,i);if(void 0===e.date||'now'===e.date)return t.now().getTime();if('reported'===e.date)return i?i.reported_date:n.contact.reported_date;throw new Error('Unrecognised value for target.date: '+e.date)}(e,n,o,a),u=e.groupBy&&e.groupBy(o,a),_=0;_<p.length;++_){var y=new t({_id:p[_]+'~'+e.id,contact:o.contact,deleted:!!d.deleted,type:e.id,pass:c,groupBy:u,date:f});e.emitCustom?e.emitCustom(m,y,o,a):m(y)}}function m(e){i('target',e)}}e.exports=function(e,t,n,a,r){for(var s=0;s<e.length;++s){var l=e[s];switch(i(l),l.appliesTo){case'contacts':o(l,a,n,r,t);break;case'reports':for(var d=0;d<t.reports.length;++d){o(l,a,n,r,t,t.reports[d])}break;default:throw new Error('Unrecognised target.appliesTo: '+l.appliesTo)}}}}]); }\n}",
    "targets": {
      "enabled": true,
      "items": []
    }
  }
}
