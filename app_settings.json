{
  "forms": {},
  "schedules": [],
  "contact_summary": "var ContactSummary = {}; !function(e,t){if('object'==typeof exports&&'object'==typeof module)module.exports=t();else if('function'==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)('object'==typeof exports?exports:e)[o]=r[o]}}(ContactSummary,(function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&'object'==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,'default',{enumerable:!0,value:e}),2&t&&'string'!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,'a',t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p='',r(r.s=0)}([function(e,t,r){var o=r(1),n=r(3);e.exports=n(o,contact,reports)},function(e,t,r){let o=r(2);const n=reports,i=[{label:'contact.profile.performance.monthly_meeting',appliesToType:'report',appliesIf:e=>{if('chw_monthly_meeting'===e.form){const t=o.getNewestReport(n,'chw_monthly_meeting');if(t)return t.reported_date===e.reported_date}return!1},fields:[{label:'contact.profile.performance.monthly_meeting.goal',value:e=>{const t=new Date(e.reported_date);if(t.getMonth()===o.CURRENT_MONTH&&t.getFullYear()===o.CURRENT_YEAR){const e=o.getReportsThisMonth(n,'chw_monthly_meeting').length;return`${100*e}% (${e} out of 1)`}return'0% (0 out of 1)'},width:6},{label:'contact.profile.performance.monthly_meeting.last_date',value:e=>e.reported_date,filter:'simpleDate',width:6}]},{label:'contact.profile.performance.group_session',appliesToType:'report',appliesIf:e=>{if('group_session'===e.form){const t=o.getNewestReport(n,'group_session');if(t)return t.reported_date===e.reported_date}return!1},fields:[{label:'contact.profile.performance.group_session.goal',value:e=>{const t=new Date(e.reported_date);if(t.getMonth()===o.CURRENT_MONTH&&t.getFullYear()===o.CURRENT_YEAR){const e=o.getReportsThisMonth(n,'group_session').length;return`${100*e}% (${e} out of 1)`}return'0% (0 out of 1)'},width:6},{label:'contact.profile.performance.group_session.last_date',value:e=>e.reported_date,filter:'simpleDate',width:6}]},{label:'contact.profile.performance.quality_monitoring',appliesToType:'report',appliesIf:e=>{if('quality_monitoring'===e.form){const t=o.getNewestReport(n,'quality_monitoring');if(t)return t.reported_date===e.reported_date}return!1},fields:[{label:'contact.profile.performance.quality_monitoring.goal',value:e=>{const t=new Date(e.reported_date);if(t.getMonth()===o.CURRENT_MONTH&&t.getFullYear()===o.CURRENT_YEAR){const e=o.getReportsThisMonth(n,'quality_monitoring').length;return`${100*e}% (${e} out of 1)`}return'0% (0 out of 1)'},width:6},{label:'contact.profile.performance.quality_monitoring.last_date',value:e=>e.reported_date,filter:'simpleDate',width:6}]}];e.exports={cards:i}},function(e,t){const r=new Date,o=r.getMonth(),n=r.getFullYear();e.exports={CURRENT_MONTH:o,CURRENT_YEAR:n,getNewestReport:function(e,t){let r,o;for(let n=0;n<e.length;n++)o=e[n],r||o.form!==t?o.form===t&&r.reported_date<o.reported_date&&(r=o):r=o;return r},getReportsThisMonth:function(e,t){let r,i=[];for(const l of e)r=new Date(l.reported_date),l.form===t&&r.getMonth()===o&&r.getFullYear()===n&&i.push(l);return i}}},function(e,t){function r(e){return e?Array.isArray(e)?e:[e]:[]}function o(e,t){switch(typeof e){case'undefined':return!0;case'function':return e(t);default:return e}}function n(e,t,r){if(o(e.appliesIf,r)){var n='function'==typeof e.fields?e.fields(r):e.fields.filter((function(e){return o(e.appliesIf,r)})).map((function(e){var t={};return i(e,t,'label'),i(e,t,'value'),i(e,t,'translate'),i(e,t,'filter'),i(e,t,'width'),i(e,t,'icon'),e.context&&(t.context={},i(e.context,t.context,'count'),i(e.context,t.context,'total')),t}));return e.modifyContext&&e.modifyContext(t,r),{label:e.label,fields:n}}function i(e,t,o){switch(typeof e[o]){case'undefined':return;case'function':t[o]=e[o](r);break;default:t[o]=e[o]}}}e.exports=function(e,t,o){var i=e.fields||[],l=e.context||{},a=e.cards||[],f=t&&('contact'===t.type?t.contact_type:t.type),p={cards:[],fields:i.filter((function(e){var t=r(e.appliesToType),o=t.filter((function(e){return e&&'!'===e.charAt(0)}));if((0===t.length||t.includes(f)||o.length>0&&!o.includes('!'+f))&&(!e.appliesIf||e.appliesIf()))return delete e.appliesToType,delete e.appliesIf,!0}))};return a.forEach((function(e){var t,i,a,u,c=r(e.appliesToType);if(c.includes('report')&&c.length>1)throw new Error('You cannot set appliesToType to an array which includes the type \\'report\\' and another type.');if(c.includes('report'))for(t=0;t<o.length;++t)i=o[t],!(u=i)||u.errors&&u.errors.length||(a=n(e,l,i))&&p.cards.push(a);else{if(!c.includes(f)&&c.length>0)return;(a=n(e,l))&&p.cards.push(a)}})),p.context=l,p}}])})); return ContactSummary;",
  "tasks": {
    "rules": "define Target { _id: null, contact: null, deleted: null, type: null, pass: null, date: null, groupBy: null }\ndefine Contact { contact: null, reports: null, tasks: null }\ndefine Task { _id: null, deleted: null, doc: null, contact: null, icon: null, date: null, readyStart: null, readyEnd: null, title: null, fields: null, resolved: null, priority: null, priorityLabel: null, reports: null, actions: null }\nrule GenerateEvents {\n  when { c: Contact } then { !function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(t,'__esModule',{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&'object'==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,'default',{enumerable:!0,value:t}),2&e&&'string'!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,'a',e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p='',n(n.s=1)}([function(t,e){t.exports=function(t){var e={};!function t(e,n){var i=Object.keys(e);for(var a in i){var o=i[a];switch(typeof e[o]){case'object':t(e[o],n);break;case'function':e[o]=e[o].bind(n)}}}(t,e),e.definition=function t(e){var n=Object.assign({},e),i=Object.keys(n);for(var a in i){var o=i[a];if(Array.isArray(n[o])){n[o]=n[o].slice(0);for(var r=0;r<n[o].length;++r)'object'==typeof n[o][r]&&(n[o][r]=t(n[o][r]))}else'object'==typeof n[o]&&(n[o]=t(n[o]))}return n}(t)}},function(t,e,n){var i=n(2),a=n(3),o=n(4);n(6)(a,c,Utils,Target,emit),o(i,c,Utils,Task,emit),emit('_complete',{_id:!0})},function(t,e){t.exports=[{name:'quality-monitoring-task',icon:'general',title:'task.quality_monitoring',appliesTo:'reports',appliesIf:function(){return user.parent&&'district_hospital'===user.parent.type},appliesToType:['quality_monitoring_planning'],actions:[{type:'report',form:'quality_monitoring'}],events:[{id:'quality-monitoring-1',dueDate:function(t,e,n){let i='';return i=n.fields&&n.fields.visit_details&&n.fields.visit_details.planned_visit_date?new Date(n.fields.visit_details.planned_visit_date):new Date,i},start:2,end:2}]},{name:'shadowing-reminder-task',icon:'general',title:'task.shadowing_reminder',appliesTo:'reports',appliesIf:function(){return user.parent&&'health_center'===user.parent.type},appliesToType:['quality_monitoring_planning'],actions:[{type:'report',form:'shadowing_reminder',modifyContent:function(t,e,n){n.fields&&n.fields.visit_details&&n.fields.visit_details.planned_visit_date?t.t_planned_visit_date=n.fields.visit_details.planned_visit_date:t.t_planned_visit_date='the planned visit date.'}}],resolvedIf:function(t,e,n,i){return Utils.isFormSubmittedInWindow(t.reports,'quality_monitoring',Utils.addDate(i,-n.start).getTime(),Utils.addDate(i,n.end+1).getTime())},events:[{id:'shadowing-reminder-1',dueDate:function(t){let e='';return e=t.fields&&t.fields.visit_details&&t.fields.visit_details.planned_visit_date?new Date(t.fields.visit_details.planned_visit_date):new Date,e},start:2,end:2}]},{name:'chw-monthly-meeting-task-1',icon:'confirm-meeting',title:'task.chw_monthly_meeting',appliesTo:'reports',appliesToType:['chw_monthly_meeting'],appliesIf:function(){return user.parent&&'district_hospital'===user.parent.type},actions:[{type:'report',form:'chw_monthly_meeting'}],resolvedIf:function(t){let e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);return Utils.isFormSubmittedInWindow(t.reports,'chw_monthly_meeting',n,i)},events:[{id:'chw-monthly-meeting-1',dueDate:function(t){let e='';return e=t.fields&&t.fields.next_meeting_details&&t.fields.next_meeting_details.next_meeting_date?new Date(t.fields.next_meeting_details.next_meeting_date):new Date,e},start:3,end:3}]},{name:'chw-monthly-meeting-task-2',icon:'confirm-meeting',title:'task.chw_monthly_meeting',appliesTo:'contacts',appliesToType:['district_hospital'],appliesIf:function(){return user.parent&&'district_hospital'===user.parent.type},actions:[{type:'report',form:'chw_monthly_meeting'}],resolvedIf:function(t){let e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);return Utils.isFormSubmittedInWindow(t.reports,'chw_monthly_meeting',n,i)},events:[{id:'chw-monthly-meeting-1',dueDate:function(){let t=new Date;return new Date(t.getFullYear(),t.getMonth(),3)},start:3,end:3}]},{name:'quality-monitoring-follow-up-task-1',icon:'general',title:'task.quality_monitoring_follow_up',appliesTo:'reports',appliesIf:function(t,e){return!!(e.fields&&e.fields.group_summary&&e.fields.group_summary.follow_up_again)&&('yes'===e.fields.group_summary.follow_up_again&&user.parent&&'district_hospital'===user.parent.type)},appliesToType:['quality_monitoring'],actions:[{type:'report',form:'quality_monitoring_follow_up',modifyContent:function(t,e,n){t.t_follow_up_areas='',n.fields&&n.fields.c_follow_up_areas&&(t.t_follow_up_areas=n.fields.c_follow_up_areas)}}],events:[{id:'quality-monitoring-follow-up-1',dueDate:function(t,e,n){return n.fields&&n.fields.group_summary&&n.fields.group_summary.next_follow_up_date?new Date(n.fields.group_summary.next_follow_up_date):new Date},start:2,end:2}]},{name:'quality-monitoring-follow-up-task-2',icon:'general',title:'task.quality_monitoring_follow_up',appliesTo:'reports',appliesIf:function(t,e){return e.fields&&e.fields.follow_up_details&&'yes'===e.fields.follow_up_details.follow_up_again&&user.parent&&'district_hospital'===user.parent.type},appliesToType:['quality_monitoring_follow_up'],actions:[{type:'report',form:'quality_monitoring_follow_up'}],events:[{id:'quality-monitoring-follow-up-1',dueDate:function(t,e,n){return n.fields&&n.fields.follow_up_details&&n.fields.follow_up_details.next_follow_up_date?new Date(n.fields.follow_up_details.next_follow_up_date):new Date},start:2,end:2}]}]},function(t,e){t.exports=[{id:'monthly-meetings-this-month',type:'count',goal:1,translation_key:'targets.monthly_meetings.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'reports',appliesToType:['chw_monthly_meeting'],appliesIf:function(t,e){return e.fields&&e.fields.planned_meeting&&e.fields.planned_meeting.meeting_option&&'now'===e.fields.planned_meeting.meeting_option},date:'reported'},{id:'group-sessions-this-month',type:'count',goal:1,translation_key:'targets.group_sessions.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'reports',appliesToType:['group_session'],date:'reported'},{id:'quality-monitoring-this-month',type:'count',goal:1,translation_key:'targets.quality_monitoring.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'reports',appliesToType:['quality_monitoring'],date:'reported'},{id:'household-visits',type:'count',goal:16,translation_key:'targets.household_visits.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'reports',appliesToType:['infant_child','pregnancy'],appliesIf:function(t,e){return e.fields&&e.fields.consent&&'yes'===e.fields.consent.child_consent_today||e.fields.pregnancy_consent&&'yes'===e.fields.pregnancy_consent.consent},date:'reported',aggregate:!0},{id:'households-all-time',type:'count',goal:130,translation_key:'targets.households.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'contacts',appliesToType:['clinic'],date:'now',aggregate:!0},{id:'population-all-time',type:'count',goal:730,translation_key:'targets.population.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'contacts',appliesToType:['person'],date:'now',aggregate:!0},{id:'under-5-population',type:'count',goal:2,translation_key:'targets.under_5_enrolled.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'reports',appliesToType:['infant_child'],date:'now',aggregate:!0},{id:'pregnancies-this-month',type:'count',goal:-1,translation_key:'targets.pregnancies_enrolled.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'reports',appliesToType:['pregnancy'],date:'reported',aggregate:!0},{id:'home-maternal-deaths-this-month',type:'count',goal:-1,translation_key:'targets.home_maternal_deaths.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'reports',appliesToType:['death_report'],appliesIf:function(t,e){return e.fields&&e.fields.suspected_maternal_death&&'home'===e.fields.suspected_maternal_death.where_death},date:'reported',aggregate:!0},{id:'facility-maternal-deaths-this-month',type:'count',goal:-1,translation_key:'targets.facility_maternal_deaths.title',subtitle_translation_key:'targets.this_month.subtitle',appliesTo:'reports',appliesToType:['death_report'],appliesIf:function(t,e){return e.fields&&e.fields.suspected_maternal_death&&'health_facility'===e.fields.suspected_maternal_death.where_death},date:'reported',aggregate:!0}]},function(t,e,n){var i=n(0),a=n(5);function o(t,e,n,i,a,o){var r;if(t.appliesToType){var s;if('contacts'===t.appliesTo){if(!a.contact)return;s='contact'===a.contact.type?a.contact.contact_type:a.contact.type}else{if(!o)return;s=o.form}if(-1===t.appliesToType.indexOf(s))return}if('scheduled_tasks'===t.appliesTo||!t.appliesIf||t.appliesIf(a,o))if('scheduled_tasks'===t.appliesTo){if(o&&t.appliesIf){if(!o.scheduled_tasks)return;for(r=0;r<o.scheduled_tasks.length;r++)t.appliesIf(a,o,r)&&p(r)}}else p();function l(t,e,n){var i;return(i='function'==typeof t.contactLabel?t.contactLabel(e,n):t.contactLabel)?{name:i}:e.contact}function p(r){var s,p,u,c,f=null;for(s=0;s<t.events.length;s++){if((p=t.events[s]).dueDate)f=p.dueDate(p,a,o,r);else if(o)f=void 0!==r?new Date(e.addDate(new Date(o.scheduled_tasks[r].due),p.days)):new Date(e.addDate(new Date(o.reported_date),p.days));else if(p.dueDate)f=p.dueDate(p,a);else{var _=a.contact&&a.contact.reported_date?new Date(a.contact.reported_date):new Date;f=new Date(e.addDate(_,p.days))}e.isTimely(f,p)&&(c={_id:(o?o._id:a.contact&&a.contact._id)+'~'+(p.id||s)+'~'+t.name,deleted:!(!(a.contact&&a.contact.deleted||o)||!o.deleted),doc:a,contact:l(t,a,o),icon:t.icon,date:f,readyStart:p.start||0,readyEnd:p.end||0,title:t.title,resolved:t.resolvedIf(a,o,p,f,r),actions:d(t.actions,p)},void 0!==r&&(c._id+='-'+r),'function'==typeof(u=t.priority)&&(u=u(a,o)),u&&(c.priority=u.level,c.priorityLabel=u.label),i('task',new n(c)))}}function d(e,n){return t.actions.map((function(t){return function(t,e){var n={source:'task',source_id:o?o._id:a.contact&&a.contact._id,contact:a.contact};t.modifyContent&&t.modifyContent(n,a,o,e);return{type:t.type||'report',form:t.form,label:t.label||'Follow up',content:n}}(t,n)}))}}t.exports=function(t,e,n,r,s){if(t)for(var l,p,d=0;d<t.length;++d)switch('function'!=typeof(l=Object.assign({},t[d],a)).resolvedIf&&(l.resolvedIf=function(t,e,i,a){return l.defaultResolvedIf(t,e,i,a,n)}),i(l),l.appliesTo){case'reports':case'scheduled_tasks':for(var u=0;u<e.reports.length;++u)p=e.reports[u],o(l,n,r,s,e,p);break;case'contacts':e.contact&&o(l,n,r,s,e);break;default:throw new Error('Unrecognised task.appliesTo: '+l.appliesTo)}}},function(t,e){t.exports={defaultResolvedIf:function(t,e,n,i,a){var o,r;a||(a=Utils);var s=function(t){var e;if(!t||!t.actions)return;return(e=t.actions.find((function(t){return!t.type||'report'===t.type})))&&e.form}(this.definition);if(!s)throw new Error('Could not find the default resolving form!');return o=0,o=e?Math.max(a.addDate(i,-n.start).getTime(),e.reported_date+1):a.addDate(i,-n.start).getTime(),r=a.addDate(i,n.end+1).getTime(),a.isFormSubmittedInWindow(t.reports,s,o,r)}}},function(t,e,n){var i=n(0);function a(t,e,n,i,a,o){var r=!!o;if(a.contact){var s='contact'===a.contact.type?a.contact.contact_type:a.contact.type,l=r?o.form:s;if(!(t.appliesToType&&t.appliesToType.indexOf(l)<0)&&(!t.appliesIf||t.appliesIf(a,o)))for(var p=r?o:a.contact,d=function(t,e,n){var i;return i='function'==typeof t.idType?t.idType(e,n):'report'===t.idType?n&&n._id:e.contact&&e.contact._id,Array.isArray(i)||(i=[i]),i}(t,a,o),u=!t.passesIf||!!t.passesIf(a,o),c=function(t,e,n,i){if('function'==typeof t.date)return t.date(n,i);if(void 0===t.date||'now'===t.date)return e.now().getTime();if('reported'===t.date)return i?i.reported_date:n.contact.reported_date;throw new Error('Unrecognised value for target.date: '+t.date)}(t,n,a,o),f=t.groupBy&&t.groupBy(a,o),_=0;_<d.length;++_){var y=new e({_id:d[_]+'~'+t.id,contact:a.contact,deleted:!!p.deleted,type:t.id,pass:u,groupBy:f,date:c});t.emitCustom?t.emitCustom(g,y,a,o):g(y)}}function g(t){i('target',t)}}t.exports=function(t,e,n,o,r){for(var s=0;s<t.length;++s){var l=t[s];switch(i(l),l.appliesTo){case'contacts':a(l,o,n,r,e);break;case'reports':for(var p=0;p<e.reports.length;++p){a(l,o,n,r,e,e.reports[p])}break;default:throw new Error('Unrecognised target.appliesTo: '+l.appliesTo)}}}}]); }\n}",
    "targets": {
      "enabled": true,
      "items": [
        {
          "id": "monthly-meetings-this-month",
          "type": "count",
          "goal": 1,
          "translation_key": "targets.monthly_meetings.title",
          "subtitle_translation_key": "targets.this_month.subtitle"
        },
        {
          "id": "group-sessions-this-month",
          "type": "count",
          "goal": 1,
          "translation_key": "targets.group_sessions.title",
          "subtitle_translation_key": "targets.this_month.subtitle"
        },
        {
          "id": "quality-monitoring-this-month",
          "type": "count",
          "goal": 1,
          "translation_key": "targets.quality_monitoring.title",
          "subtitle_translation_key": "targets.this_month.subtitle"
        },
        {
          "id": "household-visits",
          "type": "count",
          "goal": 16,
          "translation_key": "targets.household_visits.title",
          "subtitle_translation_key": "targets.this_month.subtitle",
          "aggregate": true
        },
        {
          "id": "households-all-time",
          "type": "count",
          "goal": 130,
          "translation_key": "targets.households.title",
          "subtitle_translation_key": "targets.this_month.subtitle",
          "aggregate": true
        },
        {
          "id": "population-all-time",
          "type": "count",
          "goal": 730,
          "translation_key": "targets.population.title",
          "subtitle_translation_key": "targets.this_month.subtitle",
          "aggregate": true
        },
        {
          "id": "under-5-population",
          "type": "count",
          "goal": 2,
          "translation_key": "targets.under_5_enrolled.title",
          "subtitle_translation_key": "targets.this_month.subtitle",
          "aggregate": true
        },
        {
          "id": "pregnancies-this-month",
          "type": "count",
          "goal": -1,
          "translation_key": "targets.pregnancies_enrolled.title",
          "subtitle_translation_key": "targets.this_month.subtitle",
          "aggregate": true
        },
        {
          "id": "home-maternal-deaths-this-month",
          "type": "count",
          "goal": -1,
          "translation_key": "targets.home_maternal_deaths.title",
          "subtitle_translation_key": "targets.this_month.subtitle",
          "aggregate": true
        },
        {
          "id": "facility-maternal-deaths-this-month",
          "type": "count",
          "goal": -1,
          "translation_key": "targets.facility_maternal_deaths.title",
          "subtitle_translation_key": "targets.this_month.subtitle",
          "aggregate": true
        }
      ]
    }
  }
}
